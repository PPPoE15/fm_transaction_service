key: PPKG
docker:
  image: ${bamboo.artifactory_docker}/${bamboo.dh_virtualenv_image}
  volumes:
    ${bamboo.working.directory}: /work
    ${bamboo.tmp.directory}: ${bamboo.tmp.directory}
  docker-run-arguments:
  - --rm
  - -w 
  - /work
tasks:
- checkout:
    force-clean-build: 'true'
    description: Checkout Default Repository
- inject-variables: 'bamboo-vars/.env-common'
- inject-variables: !include 'tasks/inject-vars-release.yml'
- inject-variables: !include 'tasks/inject-vars-master.yml'
- inject-variables: !include 'tasks/inject-vars-rc.yml'
- inject-variables: !include 'tasks/inject-vars-dev.yml'
- script:
    interpreter: SHELL
    file: bamboo-specs/scripts/publish_backend_job.sh
    environment: username=${bamboo.secret_username} password=${bamboo.secret_password} artifactory_deb_pkg_url=${bamboo.inject.artifactory_deb_pkg_url} branch=${bamboo.planRepository.branchName} debian_pkg_name=${bamboo.inject.debian_pkg_name} component=${bamboo.inject.component} architecture=${bamboo.inject.architecture} debian_pkg_name_with_no_version=${bamboo.inject.debian_pkg_name_with_no_version} debian_pkg_version=${bamboo.inject.debian_pkg_version}
    conditions: !include 'tasks/skip-deb-publish-condition.yml'
artifact-subscriptions: []
